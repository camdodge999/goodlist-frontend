# CSP Hash Generation Scripts

This directory contains scripts to help generate proper SHA-256 hashes for Content Security Policy (CSP) directives.

## generate-csp-hashes.mjs

Generates proper SHA-256 hashes for inline styles to be used in CSP directives.

### Usage

```bash
node scripts/generate-csp-hashes.mjs
```

### Output

The script will output properly formatted SHA-256 hashes that can be added to the `KNOWN_STYLE_HASHES` array in `src/lib/csp-utils.ts`.

### Example Output

```
hiddenStyle: 'sha256-biLFinpqYMtWHmXfkA1BPeCY0/fNt46SAZ+BBk5YUog=',
loadingSpinner: 'sha256-RYK5IRigaS6WUUU4CX6MhGDEBK+iPXy1qArgs1eoCfo=',
```

## add-csp-hash.mjs

Quickly extracts and adds CSP hashes from violation error messages.

### Usage

```bash
node scripts/add-csp-hash.mjs "CSP violation error message here"
```

### Example

```bash
node scripts/add-csp-hash.mjs "...a hash ('sha256-PhrR5O1xWiklTp5YfH8xWeig83Y/rhbrdb5whLn1pSg=')..."
```

### Features

- ‚úÖ **Automatically extracts** hash from CSP error messages
- ‚úÖ **Adds to KNOWN_STYLE_HASHES** array in source code
- ‚úÖ **Checks for duplicates** to avoid adding the same hash twice
- ‚úÖ **Provides clear feedback** on what was done

### When to Use

1. **CSP Violations**: When you see CSP violation errors in the browser console
2. **New Inline Styles**: When adding new inline styles to your application
3. **Invalid Hash Errors**: When CSP rejects hashes like `'sha256-ZGlzcGxheTogbm9uZTs='`

### Quick Workflow for CSP Violations

1. **Copy the entire CSP error message** from browser console
2. **Run the add-csp-hash script** with the error message
3. **Restart your development server** to apply changes
4. **Refresh the page** to see if the violation is resolved

Example workflow:
```bash
# Step 1: Copy CSP error from console
# Step 2: Run script
node scripts/add-csp-hash.mjs "Refused to apply inline style... a hash ('sha256-ABC123=')..."

# Step 3: Restart dev server
npm run dev
```

### Troubleshooting CSP Violations

1. Check browser console for CSP violation errors
2. Look for suggestions like "a hash ('sha256-...')"
3. Use `add-csp-hash.mjs` for quick fixes
4. Use `generate-csp-hashes.mjs` for generating hashes for known styles

### Important Notes

- ‚ö†Ô∏è **Never use base64-encoded content as SHA-256 hashes** - they will be rejected by CSP
- ‚úÖ **Always use proper SHA-256 hashes** generated by cryptographic functions
- üîí **Pre-compute hashes** for known inline styles rather than generating them dynamically
- üîÑ **Restart dev server** after adding new hashes for them to take effect 